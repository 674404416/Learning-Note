# 渲染管线

本文主要整理自https://blog.csdn.net/nikoong/article/details/79776873

与

https://blog.csdn.net/qq_36383623/article/details/81095366

### 1.定义

渲染管线是一个过程，又叫渲染过程流水线。功能是通过给定虚拟相机，3D场景和光照等因素渲染一副2D图像。

### 2.基础名词

- 3D物体：任何物体，其几何形状都是由三角形组成的。三角形，或者任何图形，都由顶点组成。
- 顶点：具有空间坐标和其他信息（如颜色和纹理坐标）的点
- 纹理：映射到3D物体表面的图像，这会造成该物体由某种材料组成的幻觉。物体的顶点存储着纹理坐标（2维向量），用于指定纹理如何映射到任何给定表面。

![](https://img-blog.csdn.net/20180401115356960?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25pa29vbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

- 齐次坐标：3D空间中的点通常需要3个坐标来指定位置。如果继续用3个坐标表示，有时会遇到问题。例如：顶点平移时的操作是加一个向量，顶点旋转时的操作是乘以3x3矩阵）。所以我们通过扩展三维向量来绕开这个问题。我们添加另一个坐标（w坐标，从而得到所谓的齐次坐标[注1]。这样一来，顶点的所有变换都可以通过将其四维坐标与特定的4x4矩阵相乘来进行，使得计算更容易。齐次坐标的另一个用途是明确区分向量和点。

### 3.三个阶段

应用阶段、几何阶段、光栅阶段



​	**应用阶段**：主要和CPU有关，进行碰撞检测、视锥裁剪。在这个阶段结束的时候，将计算好的数据（顶点坐标，法向量，纹理坐标，纹理）发送给图形硬件

​	**几何阶段**：主要和GPU（显卡的一部分）有关。该阶段用于处理绘制几何的工作（变换三维顶点坐标和光照计算），要绘制什么样的图形，怎么绘制，在哪绘制。主要负责顶点坐标变换、光照、裁剪、投影和屏幕映射。该阶段的末端得到了经过变换和投影之后的顶点坐标、颜色、以及纹理坐标。

​		光照主要是通过物体表面的法向量来计算的![](https://img-blog.csdn.net/20180401115413361?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L25pa29vbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

**物体空间->世界空间->观察空间（摄像机空间）->剪切空间->屏幕空间**  就是在这个阶段完成的

观察空间：观察空间就是将世界空间中的坐标变换到以摄像机为轴心计算各个顶点的位置。

剪切空间：剔除摄像机看不见的物体，如果物体跨过观察空间边界形成新的边缘点。

屏幕空间：根据显示窗口的大小，缩放剪辑空间。



​	**光栅阶段**：由GPU负责，使用上面产生的数据来产生屏幕上的像素点，渲染出最后的图像。主要进行了光栅化和片元着色两个工作。

光栅化：决定哪些栅格区域需要着色。

片元着色：分配颜色值和深度值到各个区域。



### 4.番外 顶点着色器和片段着色器

（1）顶点着色器

​	物体从**物体空间->世界空间->观察空间（摄像机空间）->剪切空间**

​	是顶点着色器的工作，进行转化坐标就是在顶点着色器中转换。

（2）片段着色器

​	**剪切空间->屏幕空间**是在片段着色器中，计算每个片元的颜色。



### 5.运行顺序

*顶点着色器 —> 片元着色器 —> 模板测试 —> 深度测试。*



### 6.发现了新的参考 推荐阅读

> https://www.cnblogs.com/iwiniwin/p/12515439.html